"use strict";var Util={};!function(){Util.comma=d3.format(",.0f"),Util.percentize=d3.format("%"),Util.strToFloat=function(t){return"string"!=typeof t?t:parseFloat(t.replace(/[^\d\.\-]/g,""))},Util.capitalize=function(t){return t.charAt(0).toUpperCase()+t.slice(1)},Util.sortByKey=function(t,e,n){return t.sort(function(t,n){return t[e]<n[e]?-1:t[e]>n[e]?1:0}),n?t.reverse():t},Util.getInputNumVal=function(t){var e=$(t),n=Util.strToFloat(e.val());return""===n?0:isNaN(n)||n<0?(e.val(0),0):(e.val(d3.format(",")(n)),n)},Util.populateSelect=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=d3.selectAll(t).selectAll("option").data(e);a.exit().remove();var r=a.enter().append("option");a=r.merge(a).attr("value",function(t){return"function"==typeof n.valKey?n.valKey(t):n.valKey?t[n.valKey]:t}).text(function(t){return"function"==typeof n.nameKey?n.nameKey(t):n.nameKey?t[n.nameKey]:t}),n.selected&&("boolean"==typeof n.selected?a.attr("selected",n.selected):"function"==typeof n.selected&&a.attr("selected",function(t){var e=n.valKey?t[n.valKey]:t;return n.selected(e)}))}}();var Routing={};!function(){function t(t,e){n(t);for(var a=arguments.length,r=Array(a>2?a-2:0),o=2;o<a;o++)r[o-2]=arguments[o];e&&e.apply(void 0,r),window.scrollTo(0,0)}function e(t){crossroads.parse(t)}function n(t,e){$("#page-content").html(a[t](e))}var a={};Routing.precompileTemplates=function(){$("script[type='text/x-handlebars-template']").each(function(t,e){a[e.id.replace("-template","")]=Handlebars.compile($(e).html())})},Routing.initializeRoutes=function(){crossroads.addRoute("/",function(){t("home",App.initHome)}),crossroads.addRoute("/login",function(){t("login",App.initLogin)}),hasher.prependHash="",hasher.initialized.add(e),hasher.changed.add(e),hasher.init()}}();var App={};!function(){App.initialize=function(){$(".logout-link").click(Auth.logout)},$.tooltipster.setDefaults({contentAsHTML:!0,trigger:"hover",offset:[5,-25],theme:"tooltipster-shadow",maxWidth:320}),$.noty.defaults.type="warning",$.noty.defaults.layout="center",$.noty.defaults.timeout=2e3}();var Auth={};!function(){Auth.login=function(t,e,n){fetch("/auth/login",{method:"POST",credentials:"include",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:"username="+t+"&password="+e}).then(function(t){return 200!==t.status?void noty({layout:"center",type:"warning",text:"<b>Error!</b><br>The credentials you provided are invalid!"}):void t.json().then(function(t){n(t)})})["catch"](function(t){noty({layout:"center",type:"error",text:"<b>Error sending credentials to server!</b><br>Please contact the web administrators for this tool."})})},Auth.logout=function(){fetch("/auth/logout",{method:"POST",credentials:"include",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:""}).then(function(t){return 200!==t.status?void noty({layout:"center",type:"error",text:"<b>Error logging out!</b><br>Please contact the web administrators for this tool."}):void t.json().then(function(t){noty({layout:"center",type:"success",text:"<b>You are now logged out!</b><br>Redirecting..."}),setTimeout(function(){window.location="/login.html"},500)})})["catch"](function(t){noty({layout:"center",type:"error",text:"<b>Error logging out!</b><br>Please contact the web administrators for this tool."})})},Auth.signup=function(t,e,n){fetch("/auth/signup",{method:"POST",credentials:"include",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:"username="+t+"&password="+e+"&adminPassword="+n}).then(function(t){return 200!==t.status?void noty({layout:"center",type:"warning",text:"<b>Error!</b><br>The credentials you provided are invalid!"}):void t.json().then(function(t){console.log(t)})})["catch"](function(t){noty({layout:"center",type:"error",text:"<b>Error sending credentials to server!</b><br>Please contact the web administrators for this tool."})})}}(),function(){App.initialize(),Routing.precompileTemplates(),Routing.initializeRoutes()}(),function(){App.buildForceDiagram=function(t,e){function n(t){d3.event.active||s.alphaTarget(.3).restart(),t.fx=t.x,t.fy=t.y}function a(t){t.fx=d3.event.x,t.fy=d3.event.y}function r(t){d3.event.active||s.alphaTarget(0),t.fx=null,t.fy=null}for(var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=o.width||800,l=o.height||400,c=d3.select(t).append("svg").attr("width",i).attr("height",l),s=d3.forceSimulation().velocityDecay(o.velocityDecay||.2).force("link",d3.forceLink().id(function(t){return t.index})).force("charge",d3.forceManyBody().strength(o.charge||-25)).force("center",d3.forceCenter(i/2,l/2)),u=e.map(function(t){return t.source}).concat(e.map(function(t){return t.target})),d=[],p={},f=0;f<u.length;f++){for(var h=!1,g=0;g<d.length;g++)if(u[f]===d[g].name){h=!0;break}h||(p[u[f]]=d.length,d.push({name:u[f]}))}var v=[];e.forEach(function(t){v.push({index:t.index,source:p[t.source],target:p[t.target]})});var m=c.append("g").attr("class","links").selectAll(".link").data(v).enter().append("line").attr("class","link"),y=c.append("g").attr("class","nodes").selectAll(".node").data(d).enter().append("circle").attr("class","node").attr("r",5).call(d3.drag().on("start",n).on("drag",a).on("end",r));s.nodes(d).on("tick",function(){m.attr("x1",function(t){return t.source.x}).attr("y1",function(t){return t.source.y}).attr("x2",function(t){return t.target.x}).attr("y2",function(t){return t.target.y}),y.attr("cx",function(t){return t.x}).attr("cy",function(t){return t.y})}),s.force("link").links(v)}}();var Map={};!function(){Map.createLeafletMap=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=L.map(t).setView(e.bounds||[38.1,-97.5]).setZoom(e.zoom||4),a=L.tileLayer("https://api.mapbox.com/styles/v1/jpecht/citxe4nqe005l2ilff0lknw0u/tiles/256/{z}/{x}/{y}?access_token=pk.eyJ1IjoianBlY2h0IiwiYSI6ImNpdHhlMTc5NzAwczEydHFtbnZnankzNmEifQ.79pr8-kMwzRaEzUhvvgzsw",{attribution:'Map data &copy; <a href="https://www.mapbox.com/about/maps/">Mapbox</a> &copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>',minZoom:e.minZoom||2,maxZoom:e.maxZoom||14});return a.addTo(n),n},Map.createD3Map=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=n.width||600,r=n.height||400,o=n.scale||800,i=d3.geoAlbers().scale(o).translate([a/2,r/2]),l=d3.geoPath().projection(i),c=d3.selectAll(t).append("svg").attr("width",a).attr("height",r).append("g");if(n.stateMap){var s=c.append("g");s.selectAll("path").data(topojson.feature(e,e.objects.states).features).enter().append("path").attr("class","state").attr("d",l),s.append("path").datum(topojson.mesh(e,e.objects.counties,function(t,e){return t!==e})).attr("class","counties").attr("d",l)}else{var u=c.append("g");u.selectAll("path").data(topojson.feature(e,e.objects.counties).features).enter().append("path").attr("class","county").attr("d",l),u.append("path").datum(topojson.mesh(e,e.objects.states,function(t,e){return t!==e})).attr("class","states").attr("d",l)}return{svg:c,path:l,projection:i}}}(),function(){App.buildSankey=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a={top:20,right:100,bottom:20,left:100},r=n.width||960,o=n.height||500,i=d3.selectAll(t).append("svg").classed("sankey-chart",!0).attr("width",r+a.left+a.right).attr("height",o+a.top+a.bottom).append("g").attr("transform","translate("+a.left+", "+a.top+")"),l=d3.scaleOrdinal(d3.schemeCategory10),c=d3.sankey().nodeWidth(n.nodeWidth||30).nodePadding(n.nodePadding||10).extent([[1,1],[r-1,o-6]]);c(e),i.append("g").selectAll("path").data(e.links).enter().append("path").attr("class","link").attr("d",d3.sankeyLinkHorizontal()).style("fill","none").style("stroke","black").style("stroke-opacity",.2).style("stroke-width",function(t){return Math.max(1,t.width)});var s=i.append("g").selectAll("g").data(e.nodes).enter().append("g");return s.append("rect").attr("class","node").attr("x",function(t){return t.x0}).attr("y",function(t){return t.y0}).attr("width",function(t){return t.x1-t.x0}).attr("height",function(t){return t.y1-t.y0}).style("stroke","black").style("fill",function(t){return l(t.name)}),s.append("text").attr("class","node-label").attr("x",function(t){return t.x0-6}).attr("y",function(t){return(t.y1+t.y0)/2}).attr("dy",".35em").text(function(t){return t.name}).filter(function(t){return t.x0<r/2}).attr("x",function(t){return t.x1+6}).style("text-anchor","start"),i}}(),function(){App.initSearchBar=function(t,e,n){function a(e,n){if(""===e.trim())return void u.hide();if(s=-1,r(),c=d.search(e),u.show(),0===c.length)u.find(".live-search-no-results-text").show(),u.find(".live-search-results-contents").hide();else{u.find(".live-search-no-results-text").hide(),u.find(".live-search-results-contents").show();var a=d3.select(u[0]).select(".live-search-results-contents").selectAll(".live-search-results-box").data(c.slice(0,l));a.exit().remove();var o=a.enter().append("div").attr("class","live-search-results-box");o.append("div").attr("class","live-search-results-title"),o.append("div").attr("class","live-search-results-subtitle"),a=a.merge(o).on("mousedown",function(e){$(t).val(""),n(e)}),a.select(".live-search-results-title").text(function(t){return t.NAME+" ("+t.ISO3+")"}),a.select(".live-search-results-subtitle").text(function(t){return"Population: "+Util.comma(t.POP2005)})}}function r(){if(u.find(".live-search-results-box").removeClass("active"),s>-1){var t=s+1;u.find(".live-search-results-box:nth-child("+t+")").addClass("active")}}function o(){clearTimeout(i),u.hide()}var i=void 0,l=3,c=[],s=-1,u=$(".live-search-results-container");$(t).on("focus",function(){a($(this).val(),n)}).on("blur",o).on("keyup",function(e){clearTimeout(i);var u=$(this).val();13===e.which?s>=0?($(t).val(""),o(),n(c[s])):a(u,n):27===e.which?o():40===e.which?s<l-1&&(s++,r()):38===e.which?s>-1&&(s--,r()):i=setTimeout(function(){a(u,n)},250)});var d=new Fuse(e,{threshold:.3,distance:1e5,keys:["ISO2","ISO3","FIPS","NAME"]})}}(),function(){App.buildHorizontalStackedBarChart=function(t,e){var n=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},["#4475b6","#8e536e","#d93127"].reverse());e.forEach(function(t){var e=0;t.children.forEach(function(t){t.value0=e,e+=t.value,t.value1=e}),t.value=e}),Util.sortByKey(e,"value",!0);var a={top:45,right:20,bottom:60,left:100},r=400,o=200,i=d3.select(t).append("svg").classed("horizontal-stacked-bar-chart",!0).attr("width",r+a.left+a.right).attr("height",o+a.top+a.bottom).append("g").attr("transform","translate("+a.left+", "+a.top+")"),l=d3.scaleLinear().domain([0,1.2*d3.max(e,function(t){return t.value})]).range([0,r]),c=d3.scaleBand().padding(.25).domain(e.map(function(t){return t.name})).range([0,o]),s=d3.scaleOrdinal().domain(["positive","mixed","negative"]).range(n),u=d3.axisTop().ticks(5).tickFormat(function(t){return t/1e3}).scale(l),d=d3.axisLeft().ticks(5).scale(c),p=i.selectAll(".bar-group").data(e).enter().append("g").attr("class","bar-group").attr("transform",function(t){return"translate(0, "+c(t.name)+")"});p.selectAll("rect").data(function(t){return t.children.map(function(e){return{parent:t.id,child:e}})}).enter().append("rect").attr("x",function(t){return l(t.child.value0)}).attr("width",function(t){return l(t.child.value1)-l(t.child.value0)}).attr("height",c.bandwidth()).style("fill",function(t){return s(t.child.name)}),i.append("g").attr("class","x axis").call(u),i.append("g").attr("class","y axis").call(d),i.append("text").attr("class","axis-label").attr("x",r/2).attr("y",-30).style("text-anchor","middle").style("font-size","0.9em").text("# of Conversations");var f=70,h=12,g=i.append("g").attr("transform","translate(70, "+(o+30)+")"),v=g.selectAll("g").data(n).enter().append("g").attr("transform",function(t,e){return"translate("+(f+20)*e+", 0)"});v.append("rect").attr("width",f).attr("height",h).style("fill",function(t){return t}),v.append("text").attr("x",f/2).attr("y",h+10).attr("dy",".35em").style("text-anchor","middle").text(function(t,e){return 0===e?"Positive":1===e?"Mixed":"Negative"})},App.buildVerticalStackedBarChart=function(t,e){var n=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},["#4475b6","#8e536e","#d93127"].reverse());e.forEach(function(t){var e=0;t.children.forEach(function(t){t.value0=e,e+=t.value,t.value1=e}),t.value=e});var a={top:30,right:20,bottom:80,left:80},r=400,o=200,i=d3.select(t).append("svg").classed("category-chart",!0).attr("width",r+a.left+a.right).attr("height",o+a.top+a.bottom).append("g").attr("transform","translate("+a.left+", "+a.top+")"),l=d3.scaleBand().padding(.25).domain(e.map(function(t){return t.name})).range([0,r]),c=d3.scaleLinear().domain([0,1.2*d3.max(e,function(t){return t.value})]).range([o,0]),s=d3.scaleOrdinal().domain(["positive","mixed","negative"]).range(n),u=d3.axisBottom().ticks(5).scale(l),d=d3.axisLeft().ticks(5).tickFormat(function(t){return t/1e3}).scale(c),p=i.selectAll(".bar-group").data(e).enter().append("g").attr("class","bar-group").attr("transform",function(t){return"translate("+l(t.name)+", 0)"});p.selectAll("rect").data(function(t){return t.children.map(function(e){return{parent:t.id,child:e}})}).enter().append("rect").attr("y",function(t){return c(t.child.value1)}).attr("width",l.bandwidth()).attr("height",function(t){return c(t.child.value0)-c(t.child.value1)}).style("fill",function(t){return s(t.child.name)}),i.append("g").attr("class","x axis").attr("transform","translate(0, "+o+")").call(u),i.append("g").attr("class","y axis").call(d),i.append("text").attr("class","axis-label").attr("x",r/2).attr("y",o+50).text(""),i.append("text").attr("class","axis-label").attr("x",-o/2).attr("y",-45).attr("transform","rotate(-90)").style("font-size","0.9em").style("text-anchor","middle").text("# of Conversations");var f=70,h=12,g=i.append("g").attr("transform","translate(70, "+(o+50)+")"),v=g.selectAll("g").data(n).enter().append("g").attr("transform",function(t,e){return"translate("+(f+20)*e+", 0)"});v.append("rect").attr("width",f).attr("height",h).style("fill",function(t){return t}),v.append("text").attr("x",f/2).attr("y",h+10).attr("dy",".35em").style("text-anchor","middle").text(function(t,e){return 0===e?"Positive":1===e?"Mixed":"Negative"})}}(),function(){App.initHome=function(){}}(),function(){function t(){$(".login-button").click(e),$(".password-input").on("keyup",function(t){13===t.which&&e()})}function e(){var t=$(".username-input").val(),e=$(".password-input").val();return e?void Auth.login(t,e,function(){noty({layout:"center",type:"success",text:"<b>Success! You are now logged in!</b><br>Redirecting..."}),setTimeout(function(){window.location="/"+window.location.hash},500)}):void noty({layout:"center",type:"warning",text:"Please enter a password first!"})}t()}();